# Story 3.1: Ontology List and Management Interface

## Status
Ready for Done

```text-block
REVIEW STATUS: APPROVED FOR DEVELOPMENT
Review Date: 2025-01-05
Reviewed By: Bob (Scrum Master)
Review Notes: Ontology management story approved for development.
CRUD operations with comprehensive dependency checking specified.
Export/import supports both Python and JSON formats.
Search and filtering capabilities well-defined.
Clone functionality enables ontology versioning.
Foundation story for Epic 3 - can start immediately.
```

## Story
**As a** user,
**I want** to view and manage all my ontologies in one place,
**So that** I can organize different knowledge domain schemas effectively.

## Acceptance Criteria
1. List view displaying all ontologies with name, description, entity/edge type counts
2. Create new ontology with name, description, and version fields
3. Edit ontology metadata and set active/inactive status
4. Delete ontology with confirmation and dependency checking
5. Search and filter ontologies by name or status
6. Clone existing ontology to create variations
7. Export/import ontology definitions as Python/JSON

## Tasks / Subtasks
- [x] **Task 1: Create Ontology List View** (AC: 1)
  - [x] Create OntologyList component
  - [x] Implement data table with sorting
  - [x] Add columns for name, description, counts
  - [x] Display creation and modification dates
  - [x] Add status badges (active/inactive)

- [x] **Task 2: Implement Create Ontology** (AC: 2)
  - [x] Create NewOntologyDialog component
  - [x] Build form with validation
  - [x] Add name, description, version fields
  - [x] Implement Airtable record creation
  - [x] Handle duplicate name validation

- [x] **Task 3: Add Edit Functionality** (AC: 3)
  - [x] Create EditOntologyDialog component
  - [x] Enable inline metadata editing
  - [x] Implement status toggle (active/inactive)
  - [x] Update Airtable records
  - [x] Add optimistic UI updates

- [x] **Task 4: Implement Delete with Dependencies** (AC: 4)
  - [x] Create DeleteConfirmationDialog
  - [x] Check for dependent entities/edges
  - [x] Display dependency warnings
  - [x] Implement cascade delete option
  - [x] Add undo capability (soft delete)

- [x] **Task 5: Add Search and Filtering** (AC: 5)
  - [x] Create SearchBar component
  - [x] Implement name search
  - [x] Add status filter (all/active/inactive)
  - [x] Create date range filters
  - [x] Add entity/edge count filters

- [x] **Task 6: Build Clone Feature** (AC: 6)
  - [x] Create CloneOntologyDialog
  - [x] Copy all entity/edge definitions
  - [x] Generate new ontology ID
  - [x] Allow name/version customization
  - [x] Link to parent ontology

- [x] **Task 7: Export/Import System** (AC: 7)
  - [x] Create export to Python code
  - [x] Implement JSON export format
  - [x] Build import dialog with validation
  - [x] Handle version conflicts
  - [x] Add format conversion utilities

## Dev Notes

### Component Structure
```
src/components/ontology/
├── OntologyList.tsx         # Main list view
├── OntologyTable.tsx        # Data table component
├── OntologyCard.tsx         # Card view option
├── dialogs/
│   ├── NewOntologyDialog.tsx
│   ├── EditOntologyDialog.tsx
│   ├── DeleteOntologyDialog.tsx
│   ├── CloneOntologyDialog.tsx
│   └── ImportOntologyDialog.tsx
├── filters/
│   ├── OntologySearchBar.tsx
│   └── OntologyFilters.tsx
└── export/
    ├── PythonExporter.tsx
    └── JsonExporter.tsx
```

### Ontology Data Model
```typescript
interface Ontology {
  id: string
  name: string
  description: string
  version: string
  status: 'active' | 'inactive' | 'archived'
  entityTypes: EntityDefinition[]
  edgeTypes: EdgeDefinition[]
  metadata: {
    createdAt: Date
    updatedAt: Date
    createdBy: string
    lastModifiedBy: string
    parentOntologyId?: string  // For cloned ontologies
  }
  statistics: {
    entityTypeCount: number
    edgeTypeCount: number
    totalEntities: number
    totalEdges: number
    lastUsed?: Date
  }
}
```

### Airtable Schema
```typescript
// Ontologies Table
interface OntologyRecord {
  id: string
  name: string
  description: string
  version: string
  status: string
  entityDefinitions: string[]  // Links to EntityDefinitions table
  edgeDefinitions: string[]    // Links to EdgeDefinitions table
  createdAt: Date
  updatedAt: Date
  createdBy: string
  parentOntologyId?: string
}
```

### Export Formats

#### Python Export
```python
# ontology_v1_0.py
from pydantic import BaseModel, Field
from typing import Optional
from datetime import datetime

class Person(BaseModel):
    """Person entity type"""
    first_name: str = Field(description="First name")
    last_name: str = Field(description="Last name")
    age: Optional[int] = Field(description="Age in years")
    
class Company(BaseModel):
    """Company entity type"""
    name: str = Field(description="Company name")
    founded: datetime = Field(description="Foundation date")

edge_type_map = {
    "Employment": {"source": "Person", "target": "Company"},
    "Partnership": {"source": "Company", "target": "Company"}
}
```

#### JSON Export
```json
{
  "version": "1.0",
  "name": "Business Ontology",
  "entityTypes": [
    {
      "name": "Person",
      "fields": [
        {"name": "first_name", "type": "str", "required": true},
        {"name": "last_name", "type": "str", "required": true},
        {"name": "age", "type": "int", "required": false}
      ]
    }
  ],
  "edgeTypes": [
    {
      "name": "Employment",
      "source": "Person",
      "target": "Company",
      "fields": []
    }
  ]
}
```

### Dependency Checking
```typescript
async function checkOntologyDependencies(ontologyId: string): Promise<Dependencies> {
  const dependencies = {
    entities: await getEntitiesUsingOntology(ontologyId),
    edges: await getEdgesUsingOntology(ontologyId),
    documents: await getDocumentsProcessedWithOntology(ontologyId),
    graphs: await getGraphsUsingOntology(ontologyId)
  }
  
  return {
    ...dependencies,
    canDelete: dependencies.entities.length === 0 && 
               dependencies.edges.length === 0,
    requiresCascade: dependencies.entities.length > 0 ||
                    dependencies.edges.length > 0
  }
}
```

### Search Implementation
```typescript
interface OntologyFilters {
  searchTerm?: string
  status?: 'all' | 'active' | 'inactive' | 'archived'
  dateRange?: { start: Date, end: Date }
  minEntityTypes?: number
  maxEntityTypes?: number
  hasEntities?: boolean
}

function useOntologySearch(filters: OntologyFilters) {
  return useQuery({
    queryKey: ['ontologies', filters],
    queryFn: () => searchOntologies(filters),
    keepPreviousData: true
  })
}
```

### shadcn-ui Components to Use
- DataTable (with Tanstack Table)
- Dialog (for create/edit/delete)
- Form (with React Hook Form)
- Input, Textarea, Select
- Badge (for status)
- Button (actions)
- Command (search)
- Tabs (list/card view)

### Testing Standards
- Test CRUD operations
- Validate dependency checking
- Test export/import formats
- Verify search functionality
- Test clone operation
- Check optimistic updates

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-05 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-05 | 1.1 | Reviewed and approved for development | Bob (Scrum Master) |
| 2025-01-08 | 1.2 | Implementation complete, all tasks done | James (Dev) |

## Dev Agent Record

### Agent Model Used
claude-opus-4-1-20250805

### Debug Log References
- All components successfully implemented
- Gate: PASS with no issues
- All 7 tasks completed

### Completion Notes List
- OntologyList component with full CRUD operations
- Search and filtering functionality operational
- Clone feature for ontology versioning
- Export/import supporting Python and JSON formats
- All acceptance criteria met

### File List
- src/components/ontology/OntologyList.tsx
- src/components/ontology/OntologyTable.tsx
- src/components/ontology/filters/OntologySearchBar.tsx
- src/components/ontology/dialogs/NewOntologyDialog.tsx
- src/components/ontology/dialogs/EditOntologyDialog.tsx
- src/components/ontology/dialogs/DeleteOntologyDialog.tsx
- src/components/ontology/dialogs/CloneOntologyDialog.tsx
- src/components/ontology/dialogs/ImportOntologyDialog.tsx
- src/lib/airtable/services/ontology.service.ts

## QA Results

### Review Date: 2025-01-05

### Reviewed By: Quinn (Test Architect)

**Test Design**: Comprehensive test strategy created with 33 test scenarios covering all acceptance criteria. Strong coverage across unit (17), integration (11), and E2E (5) tests. Priority distribution ensures critical path validation.

**Risk Assessment**: Well-designed CRUD operations with robust dependency checking. Export/import functionality thoroughly specified. Search and filtering capabilities complete.

### Gate Status

Gate: PASS → docs/qa/gates/3.1-ontology-list-and-management-interface.yml

---
**Story Points**: 5 (2-3 days)
**Sprint**: Sprint 3
**Priority**: P0 - Must Have
**Dependencies**: Epic 1 and Epic 2 should be completed first