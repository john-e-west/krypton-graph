# Story 1.4: Dashboard with System Health

## Status
Ready for Review

```text-block
REVIEW STATUS: APPROVED FOR DEVELOPMENT
Review Date: 2025-01-04
Reviewed By: Bob (Scrum Master)
Review Notes: Dashboard story is comprehensive with clear metrics and KPIs.
Performance requirements explicitly stated (<3 seconds on 3G).
Health check API specification provided with JSON format.
Activity feed and polling mechanism well-defined.
All dependencies on Stories 1.1, 1.2, and 1.3 are noted.
Ready for development as final story of Sprint 1.
```

## Story
**As a** user,
**I want** a dashboard showing system status and recent activity,
**So that** I can quickly understand the current state of my knowledge graphs.

## Acceptance Criteria
1. Dashboard displays connection status to Airtable
2. Recent activity feed showing last 10 processed documents
3. Summary cards for total documents, ontologies, and graphs
4. Health check endpoint at /api/health returning system status
5. Real-time update of connection status using polling or websockets
6. Error states displayed when services are unavailable
7. Dashboard loads in <3 seconds on 3G connection

## Tasks / Subtasks
- [x] **Task 1: Create Dashboard Layout** (AC: 1, 2, 3)
  - [x] Create DashboardPage component
  - [x] Implement grid layout for cards
  - [x] Add responsive design for different screen sizes
  - [x] Create container for activity feed

- [x] **Task 2: Build Status Cards** (AC: 3)
  - [x] Create StatsCard component using shadcn-ui Card
  - [x] Implement TotalDocumentsCard with count
  - [x] Implement OntologiesCard with count
  - [x] Implement GraphsCard with count
  - [x] Add loading skeletons for cards

- [x] **Task 3: Implement Connection Status** (AC: 1, 6)
  - [x] Create ConnectionStatus component
  - [x] Add Airtable connection check
  - [x] Display status indicator (green/yellow/red)
  - [x] Show error message when disconnected
  - [x] Add retry button for failed connections

- [x] **Task 4: Create Activity Feed** (AC: 2)
  - [x] Create ActivityFeed component
  - [x] Fetch recent documents from Airtable
  - [x] Display document name, type, and timestamp
  - [x] Implement pagination or "load more"
  - [x] Add empty state when no activities

- [x] **Task 5: Add Health Check API** (AC: 4)
  - [x] Create /api/health endpoint
  - [x] Check Airtable connectivity
  - [x] Return system status JSON
  - [x] Include version information
  - [x] Add response time metrics

- [x] **Task 6: Implement Real-time Updates** (AC: 5)
  - [x] Set up polling mechanism (30-second intervals)
  - [x] Create usePolling custom hook
  - [x] Update connection status automatically
  - [x] Refresh activity feed periodically
  - [x] Handle cleanup on unmount

- [x] **Task 7: Optimize Performance** (AC: 7)
  - [x] Implement lazy loading for components
  - [x] Add data caching with React Query
  - [x] Optimize bundle size
  - [x] Test on slow 3G connection
  - [x] Add performance monitoring

## Dev Notes

### Dashboard Component Structure
```
src/components/dashboard/
├── DashboardPage.tsx      # Main dashboard container
├── StatsCard.tsx         # Reusable stats card
├── ConnectionStatus.tsx  # Service health indicator
├── ActivityFeed.tsx      # Recent activity list
└── ActivityItem.tsx      # Single activity entry
```

### Stats to Display
```typescript
interface DashboardStats {
  totalDocuments: number
  totalOntologies: number
  totalGraphs: number
  lastSync: Date
  systemHealth: 'healthy' | 'degraded' | 'error'
}
```

### Activity Feed Item Structure
```typescript
interface ActivityItem {
  id: string
  type: 'document_added' | 'ontology_updated' | 'graph_created'
  title: string
  description: string
  timestamp: Date
  status: 'success' | 'pending' | 'error'
}
```

### Health Check Response Format
```json
{
  "status": "healthy",
  "version": "1.0.0",
  "services": {
    "airtable": {
      "status": "connected",
      "responseTime": 125
    },
    "api": {
      "status": "operational",
      "uptime": 3600
    }
  },
  "timestamp": "2025-01-04T12:00:00Z"
}
```

### Polling Implementation
```typescript
// hooks/usePolling.ts
const usePolling = (callback: () => void, interval: number) => {
  useEffect(() => {
    const timer = setInterval(callback, interval)
    return () => clearInterval(timer)
  }, [callback, interval])
}
```

### Performance Requirements
- Initial load: < 1 second on broadband
- 3G load time: < 3 seconds
- Time to interactive: < 2 seconds
- Lighthouse score: > 90

### shadcn-ui Components to Use
- Card (for stat cards)
- Skeleton (for loading states)
- Alert (for error messages)
- Badge (for status indicators)
- ScrollArea (for activity feed)

### Caching Strategy
- Cache dashboard stats for 1 minute
- Cache activity feed for 30 seconds
- Invalidate cache on user actions
- Use React Query for cache management

### Testing Standards
- Test all data fetching scenarios
- Verify polling mechanism works
- Test error states and recovery
- Validate performance metrics
- Test responsive layout

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-04 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-04 | 1.1 | Reviewed and approved for development | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (Opus 4.1)

### Debug Log References
- Dashboard implementation completed
- All tasks successfully implemented
- Tests created and passing

### Completion Notes List
- Implemented full dashboard layout with responsive design
- Created reusable StatsCard component for metrics display
- Built ConnectionStatus component with real-time status updates
- Developed ActivityFeed with recent items from Airtable
- Added health check API endpoint
- Implemented polling mechanisms for real-time updates
- Optimized performance with lazy loading and React Query caching
- All acceptance criteria met

### File List
- src/components/dashboard/DashboardPage.tsx (Created)
- src/components/dashboard/StatsCard.tsx (Created)
- src/components/dashboard/ConnectionStatus.tsx (Created)
- src/components/dashboard/ActivityFeed.tsx (Created)
- src/components/dashboard/ActivityItem.tsx (Created)
- src/api/health.ts (Created)
- src/hooks/usePolling.ts (Created)
- src/pages/Dashboard.tsx (Modified)
- src/components/dashboard/__tests__/dashboard.test.tsx (Created)
- src/api/__tests__/health.test.ts (Created)

## QA Results
*To be completed after implementation*

---
**Story Points**: 5 (2-3 days)
**Sprint**: Sprint 1
**Priority**: P0 - Must Have
**Dependencies**: Stories 1.1, 1.2, and 1.3 must be completed first